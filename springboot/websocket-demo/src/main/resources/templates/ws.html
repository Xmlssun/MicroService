<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SpringBoot + websocket+ 广播</title>
</head>
<body onload="disconnect()">
<div>
  <div>
    <button id="connect" onclick="connect();">连接</button>
    <button id="disconnect" onclick="disconnect();" disabled="disabled">断开连接</button>
  </div>
  <div>
    <label>myUserId</label>
    <input type="text" id="myUserId" />
    <label>toUserId</label>
    <input type="text" id="toUserId" />
    <label>message</label>
    <input type="text" id="message" />
    <button id="send" onclick="send();">发送</button>
    <p id="response"></p>
  </div>
</div>

<script src="https://cdn.bootcss.com/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://cdn.bootcss.com/sockjs-client/1.3.0/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
<script type="text/javascript">
  var ws = null;

  function setConnected(connected){
    if(connected){
      $("#connect").prop("disabled",true);
      $("#disconnect").prop("disabled",false);
    }else{
      $("#disconnect").prop("disabled",true);
      $("#connect").prop("disabled",false);
    }
  }

  function connect(){
    var myUserId = $("#myUserId").val();
    ws = new WebSocket("ws://localhost:8080/sendMessage?myUserId=" + myUserId);

    ws.onopen = function(evt){
      console.log("connect success");
      setConnected(true);
    }

    ws.onmessage = function(evt){
      $("#response").append("<span>"+ evt.data+"</span></br>")
    }

    ws.onclose = function(evt){
      console.log("connection close");
      setConnected(false);
    }
  }

  function disconnect(){
    if(ws != null){
      ws.close();
      setConnected(false);
    }

  }

  function send() {
    var fromUserId = $("#myUserId").val();
    var toUserId = $("#toUserId").val();
    var message = $("#message").val();
    ws.send(JSON.stringify({
      fromUserId: fromUserId,
      toUserId: toUserId,
      message: message
    }));
  }
</script>
</body>
</html>